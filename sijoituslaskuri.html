<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sijoitustuottolaskuri — Talousvahti</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root {
    --blue: #0384fc;
    --bg: #0f0f0f;
    --card: #1a1a1a;
    --card-2: #141414;
    --muted: #aaa;
  }

  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Arial,Helvetica,sans-serif;-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}

  /* NAVBAR */
  .navbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#000;padding:15px 24px;border-bottom:2px solid #222;
    position:sticky;top:0;z-index:3000;
  }
  .brand{font-size:26px;font-weight:700;letter-spacing:1px;color:#fff}
  .nav-links{display:flex;gap:20px;align-items:center;margin:0;padding:0;list-style:none}
  .nav-links a{color:#fff;font-size:16px;padding:6px 10px;border-radius:6px;transition:all .18s}
  .nav-links a.active, .nav-links a:hover{background:#1a1a1a;color:#ccc}

  /* Hamburger (mobile) */
  .hamburger{display:none;flex-direction:column;gap:6px;cursor:pointer}
  .hamburger span{display:block;width:26px;height:3px;background:#fff;border-radius:3px;transition:transform .2s,opacity .2s}
  .hamburger.open span:nth-child(1){transform:translateY(6px) rotate(45deg)}
  .hamburger.open span:nth-child(2){opacity:0}
  .hamburger.open span:nth-child(3){transform:translateY(-6px) rotate(-45deg)}

  /* Mobile menu and overlay */
  .mobile-menu{
    display:none;
    position:fixed; top:64px; right:16px; width:240px; max-width:80%;
    background:#111; border-radius:10px; box-shadow:0 8px 30px rgba(0,0,0,.6);
    flex-direction:column; z-index:4000; overflow:hidden;
  }
  .mobile-menu a{padding:14px 16px;border-bottom:1px solid #222;color:#fff}
  .mobile-menu a:hover{background:#222;color:var(--blue)}
  .overlay{
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:3500;
  }

  /* Calculator card */
  .calculator-container{
    max-width:980px;margin:36px auto;padding:28px;background:var(--card);border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.6);
  }
  .calculator-container h1{margin:0 0 18px 0;font-size:22px;color:#fff;text-align:center;padding-bottom:8px;border-bottom:1px solid #222}

  .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}
  .col-full{grid-column:1/-1}

  .input-group{background:linear-gradient(180deg,#171717,#141414);padding:14px;border-radius:10px;border:1px solid #212121}
  .input-group label{display:block;color:#cfcfcf;font-weight:600;margin-bottom:8px;font-size:14px}
  .input-row{display:flex;gap:12px;align-items:center}
  input[type="number"]{
    width:120px;padding:8px;border-radius:8px;border:1px solid #2a2a2a;background:var(--bg);color:#fff;font-size:15px;
  }
  input[type="range"]{flex:1;height:6px;background:#2b2b2b;border-radius:6px;appearance:none}
  input[type="range"]::-webkit-slider-thumb{appearance:none;width:16px;height:16px;border-radius:50%;background:var(--blue);cursor:pointer;box-shadow:0 0 6px rgba(3,132,252,.18)}
  .muted{color:var(--muted);font-size:13px;margin-top:8px}

  /* Results */
  .results{margin-top:20px;padding:18px;border-radius:12px;background:linear-gradient(180deg,var(--card-2),#0f0f0f);border:1px solid #222;text-align:center}
  .results h3{margin:0;color:#fff;font-size:18px}
  .total{font-size:28px;font-weight:700;color:var(--blue);margin-top:6px}
  .sub{color:#ddd;margin-top:6px;font-size:14px}

  .chart-container{margin-top:18px;width:100%;height:420px;border-radius:10px;padding:6px;background:linear-gradient(180deg,#0f0f0f,#0b0b0b)}
  /* Mobile adjustments */
  @media (max-width:768px){
    .nav-links{display:none}
    .hamburger{display:flex}
    .grid{grid-template-columns:1fr;gap:12px}
    .chart-container{height:520px}
    /* show mobile menu via class 'open' */
    .mobile-menu.open{display:flex}
    .overlay.show{display:block}
  }
</style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar">
    <div class="brand">Talousvahti</div>
    <ul class="nav-links" id="navLinks">
      <li><a href="index.html">Talousuutiset</a></li>
      <li><a href="Blogi.html">Blogi</a></li>
      <li><a href="sisapiiri.html">Sisäpiirikaupat</a></li>
      <li><a href="laskuri.html" class="active">Sijoitustuottolaskuri</a></li>
      <li><a href="#tietoa">Tietoa</a></li>
    </ul>

    <div class="hamburger" id="hamburger" aria-label="Valikko" role="button" tabindex="0">
      <span></span><span></span><span></span>
    </div>
  </nav>

  <!-- Mobile menu + overlay -->
  <div class="mobile-menu" id="mobileMenu">
    <a href="index.html">Talousuutiset</a>
    <a href="Blogi.html">Blogi</a>
    <a href="sisapiiri.html">Sisäpiirikaupat</a>
    <a href="laskuri.html" class="active">Sijoitustuottolaskuri</a>
    <a href="#tietoa">Tietoa</a>
  </div>
  <div class="overlay" id="overlay"></div>

  <!-- Calculator -->
  <main class="calculator-container" role="main">
    <h1>Sijoitustuottolaskuri</h1>

    <div class="grid">
      <div class="input-group">
        <label for="initial">Aloitussumma (€)</label>
        <div class="input-row">
          <input type="number" id="initial" value="1000" min="0" step="100" />
          <input type="range" id="initialRange" min="0" max="1000000" step="100" value="1000" />
        </div>
        <div class="muted">Voit kirjoittaa luvun tai käyttää liukusäädintä.</div>
      </div>

      <div class="input-group">
        <label for="return">Tuotto per vuosi (%)</label>
        <div class="input-row">
          <input type="number" id="return" value="7" min=" -50" max="100" step="0.1" />
          <input type="range" id="returnRange" min="-50" max="100" step="0.1" value="7" />
        </div>
        <div class="muted">Syötä vuosituotto prosentteina.</div>
      </div>

      <div class="input-group">
        <label for="years">Säästöaika (vuosina)</label>
        <div class="input-row">
          <input type="number" id="years" value="20" min="1" max="80" step="1" />
          <input type="range" id="yearsRange" min="1" max="80" step="1" value="20" />
        </div>
        <div class="muted">Kuinka monta vuotta säästät?</div>
      </div>

      <div class="input-group">
        <label for="monthly">Kuukausittainen säästösumma (€)</label>
        <div class="input-row">
          <input type="number" id="monthly" value="200" min="0" max="10000" step="10" />
          <input type="range" id="monthlyRange" min="0" max="10000" step="10" value="200" />
        </div>
        <div class="muted">Lisättävä summa joka kuukausi.</div>
      </div>

      <div class="col-full results">
        <h3>Kertynyt pääoma</h3>
        <div class="total" id="total">0 €</div>
        <div class="sub"><span id="duration">0</span> vuotta</div>

        <div class="chart-container">
          <canvas id="growthChart" aria-label="Pääoman kehitys" role="img"></canvas>
        </div>
      </div>
    </div>
  </main>

<script>
/* ----------------------------
   Hamburger (mobile) logic
   ---------------------------- */
const hamburger = document.getElementById('hamburger');
const mobileMenu = document.getElementById('mobileMenu');
const overlay = document.getElementById('overlay');

function openMenu() {
  mobileMenu.classList.add('open');
  overlay.classList.add('show');
  hamburger.classList.add('open');
  // prevent body scroll on mobile
  document.body.style.overflow = 'hidden';
}
function closeMenu() {
  mobileMenu.classList.remove('open');
  overlay.classList.remove('show');
  hamburger.classList.remove('open');
  document.body.style.overflow = '';
}
hamburger.addEventListener('click', () => {
  if (mobileMenu.classList.contains('open')) closeMenu(); else openMenu();
});
overlay.addEventListener('click', closeMenu);
// close menu when clicking link inside
mobileMenu.addEventListener('click', (e) => {
  if (e.target.tagName === 'A') closeMenu();
});
// keyboard accessibility
hamburger.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); hamburger.click(); } });

/* ----------------------------
   Inputs & syncing
   ---------------------------- */
const qs = sel => document.querySelector(sel);
const qsa = sel => document.querySelectorAll(sel);

const initial = qs('#initial'), initialRange = qs('#initialRange');
const yearlyReturn = qs('#return'), returnRange = qs('#returnRange');
const years = qs('#years'), yearsRange = qs('#yearsRange');
const monthly = qs('#monthly'), monthlyRange = qs('#monthlyRange');

const totalEl = qs('#total'), durationEl = qs('#duration');

function sync(input, range) {
  // update range if typing
  input.addEventListener('input', () => {
    // clamp numeric fields to min/max if present
    if (input.type === 'number') {
      const min = parseFloat(input.min); const max = parseFloat(input.max);
      let val = parseFloat(input.value);
      if (!isNaN(min) && val < min) { /* allow */ }
      if (!isNaN(max) && val > max) { /* allow */ }
    }
    range.value = input.value;
    calculate();
  });
  range.addEventListener('input', () => {
    input.value = range.value;
    calculate();
  });
}
sync(initial, initialRange);
sync(yearlyReturn, returnRange);
sync(years, yearsRange);
sync(monthly, monthlyRange);

/* ----------------------------
   Deterministic PRNG (mulberry32)
   - used so chart's "aaltoilu" is consistent per inputs
   ---------------------------- */
function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}

/* ----------------------------
   Chart.js setup (no point markers)
   ---------------------------- */
const ctx = document.getElementById('growthChart').getContext('2d');
const growthChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      {
        label: 'Säästetty summa (ilman tuottoa)',
        data: [],
        borderColor: '#8a8a8a',
        backgroundColor: 'transparent',
        borderWidth: 2,
        tension: 0,
        pointRadius: 0,
        pointHoverRadius: 4
      },
      {
        label: 'Kokonaissaldo (tuotto mukaan)',
        data: [],
        borderColor: 'var(--blue)',
        backgroundColor: 'transparent',
        borderWidth: 2,
        tension: 0.35,
        pointRadius: 0,
        pointHoverRadius: 4
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { labels: { color: '#fff' } },
      tooltip: {
        callbacks: {
          label: function(context) {
            const v = context.raw;
            return context.dataset.label + ': ' + Number(v).toLocaleString('fi-FI', {style:'currency',currency:'EUR'});
          }
        }
      }
    },
    scales: {
      x: {
        title: { display: true, text: 'Vuodet', color:'#cfcfcf' },
        ticks: { color:'#fff' },
        grid: { color: 'rgba(255,255,255,0.03)' }
      },
      y: {
        title: { display: true, text: 'EUR', color:'#cfcfcf' },
        ticks: {
          color: '#fff',
          callback: function(val) {
            // nice formatting for large numbers
            return Number(val).toLocaleString('fi-FI') + ' €';
          }
        },
        grid: { color: 'rgba(255,255,255,0.03)' }
      }
    }
  }
});

/* ----------------------------
   Calculation & chart data
   ---------------------------- */
function calculate() {
  // read inputs (safely)
  const P = Math.max(0, Number(initial.value) || 0);
  const annualReturn = Number(yearlyReturn.value) / 100; // yearly
  const yearsCount = Math.max(1, parseInt(years.value) || 1);
  const contribMonthly = Math.max(0, Number(monthly.value) || 0);

  // update totals using monthly compounding for final total
  const monthlyRate = (annualReturn) / 12;
  const months = yearsCount * 12;

  // compute final total precisely
  let total = P * Math.pow(1 + monthlyRate, months);
  for (let i = 1; i <= months; i++) {
    total += contribMonthly * Math.pow(1 + monthlyRate, months - i);
  }

  totalEl.textContent = total.toLocaleString('fi-FI', { style: 'currency', currency: 'EUR' });
  durationEl.textContent = yearsCount;

  // Build chart arrays year-by-year
  const labels = [];
  const saved = [];      // straight line: P + contrib*12*year
  const invested = [];   // cumulative with annual returns + volatility

  // deterministic seed from inputs so graph is repeatable per same inputs
  const seed = Math.floor(P) + Math.floor(annualReturn * 10000) + (yearsCount * 1000) + Math.floor(contribMonthly);
  const rng = mulberry32(seed);

  let currentTotal = P;

  for (let y = 1; y <= yearsCount; y++) {
    labels.push(String(y));

    // saved without returns:
    const savedThis = P + contribMonthly * 12 * y;
    saved.push(Math.round(savedThis));

    // simulate yearly growth with small deterministic noise
    // ensure noise mean zero and moderate amplitude:
    const volatility = 0.08; // max ±4% approx => (rng()-0.5)*volatility
    const noise = (rng() - 0.5) * volatility;
    const annualFactor = 1 + annualReturn + noise;

    // Avoid extreme negative collapse:
    const safeFactor = Math.max(annualFactor, -0.9);

    currentTotal = currentTotal * safeFactor + contribMonthly * 12;
    invested.push(Math.round(currentTotal));
  }

  // Update chart data and redraw
  growthChart.data.labels = labels;
  growthChart.data.datasets[0].data = saved;
  growthChart.data.datasets[1].data = invested;

  // adjust y-axis max/min to have comfortable padding:
  const allVals = saved.concat(invested);
  const maxVal = Math.max(...allVals);
  const minVal = Math.min(...allVals);
  const padding = Math.max(1000, Math.round((maxVal - minVal) * 0.12));
  growthChart.options.scales.y.min = Math.max(0, minVal - padding);
  growthChart.options.scales.y.max = maxVal + padding;

  growthChart.update();
}

/* initial calculate */
calculate();

/* recalc on input changes (already wired by sync) but ensure other triggers update */
[initial, yearlyReturn, years, monthly].forEach(el => el.addEventListener('change', calculate));

/* Ensure chart resizes correctly on orientation change / resize */
window.addEventListener('resize', () => {
  growthChart.resize();
});
</script>
</body>
</html>

