<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Osakehaku â€“ Yahoo Finance</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start py-12">
  <h1 class="text-3xl font-bold mb-8">ğŸ“ˆ Osakehaku (Yahoo Finance)</h1>

  <div class="flex gap-2 mb-6">
    <input
      id="symbolInput"
      type="text"
      placeholder="SyÃ¶tÃ¤ osakkeen tunnus, esim. AAPL"
      class="border rounded-lg p-2 w-64 focus:outline-none focus:ring focus:ring-blue-300"
    />
    <button
      id="searchBtn"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
    >
      Hae
    </button>
  </div>

  <div id="result" class="bg-white shadow-md rounded-xl p-6 w-80 text-center hidden">
    <h2 id="symbolName" class="text-xl font-semibold mb-2"></h2>
    <p id="price" class="text-2xl font-bold"></p>
    <p id="change" class="mt-2"></p>
  </div>

  <script>
    const input = document.getElementById('symbolInput');
    const button = document.getElementById('searchBtn');
    const resultDiv = document.getElementById('result');
    const symbolName = document.getElementById('symbolName');
    const priceEl = document.getElementById('price');
    const changeEl = document.getElementById('change');

    button.addEventListener('click', async () => {
      const symbol = input.value.trim().toUpperCase();
      if (!symbol) return;

      try {
        const res = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`);
        const data = await res.json();

        if (!data.chart?.result) {
          alert('Virhe: osaketta ei lÃ¶ytynyt.');
          return;
        }

        const result = data.chart.result[0];
        const meta = result.meta;
        const price = meta.regularMarketPrice;
        const prevClose = meta.chartPreviousClose;
        const change = price - prevClose;
        const changePct = ((change / prevClose) * 100).toFixed(2);

        symbolName.textContent = `${meta.symbol}`;
        priceEl.textContent = `${price.toFixed(2)} USD`;
        changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePct}%)`;
        changeEl.className = change >= 0 ? 'text-green-600 mt-2' : 'text-red-600 mt-2';

        resultDiv.classList.remove('hidden');
      } catch (err) {
        alert('Haku epÃ¤onnistui. Tarkista tunnus tai yhteys.');
        console.error(err);
      }
    });
  </script>
</body>
</html>
